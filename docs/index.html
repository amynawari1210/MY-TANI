<!doctype html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#2f7d32" />
<link rel="manifest" href="manifest.json" />
<title>MY TANI</title>
<style>
/* ---------- base / reset ---------- */
*{box-sizing:border-box}
body{margin:0;font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial; background:#f2f2f2;color:#0b2540}
a{color:inherit}

/* ---------- header ---------- */
.header{background:#2f7d32;color:#fff;padding:26px 16px 22px;text-align:center}
.title{font-size:28px;font-weight:800;letter-spacing:1px}
.subtitle{font-size:14px;opacity:.95;margin-top:6px}

/* ---------- container ---------- */
.container{padding:14px;max-width:760px;margin:0 auto}

/* ---------- buttons / nav ---------- */
.btn{display:block;width:100%;background:#fff;border:3px solid #2f7d32;border-radius:14px;padding:18px 16px;margin-bottom:14px;text-align:left;font-size:18px;color:#2f7d32;font-weight:700;box-shadow:0 6px 14px rgba(0,0,0,0.04)}
.btn small{display:block;font-weight:400;color:#666;margin-top:6px}
.back-btn{border:3px dashed #2f7d32;padding:18px;border-radius:14px;color:#2f7d32;font-weight:700;margin-bottom:14px;cursor:pointer}

/* ---------- cards / sensors ---------- */
.sensor-card{background:#fff;border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 8px 24px rgba(0,0,0,0.04)}
.card-title{font-size:20px;font-weight:800;margin-bottom:6px}
.title{font-weight:800;font-size:20px;color:#0b2540}
.subtitle{color:#666;font-size:13px;margin-bottom:10px}
.value-badge{float:right;background:#2f7d32;color:#fff;padding:8px 12px;border-radius:12px;font-weight:800}

/* canvas / chart container */
canvas{width:100%;height:70px;display:block}
.chart{padding:12px 0}

/* small spacing at bottom so footer not overlap */
.footer-spacer{height:36px}

/* footer */
.footer{padding:18px;text-align:center;color:#666;font-size:14px;margin-top:6px}

/* small screen tweaks */
@media(min-width:700px){ .container{padding:24px} }
</style>
</head>
<body data-theme="green">

<div class="header">
<div class="title">MY TANI</div>
<div class="subtitle">Ladang Pintar Di Hujung Jari Anda</div>
</div>

<div class="container">

<!-- MAIN SCREEN -->
<div id="main" class="screen active">
<div class="btn" onclick="show('dashboard')">ğŸ“¡ Monitor Tanaman <small>Tap untuk lihat ringkasan</small></div>
<div class="btn" onclick="show('drone')">ğŸš Monitor Drone <small>Animasi drone & telemetry</small></div>
<div class="btn" onclick="show('pump')">ğŸ’§ Kawal Pam Air <small>Tekan ON/OFF untuk kawal</small></div>
<div class="btn" onclick="show('sensor')">ğŸŒ¡ï¸ Suhu & Kelembapan <small>Graf sensor live</small></div>
<div class="btn" onclick="show('stock')">ğŸ“¦ Stok Tanaman <small>Table & graf</small></div>
<div class="btn" onclick="show('sales')">ğŸ›’ Jualan <small>Invoice card & ringkasan</small></div>

<div style="height:12px"></div>
<div class="footer">Â© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>

<!-- DASHBOARD RINGKAS (for plants summary) -->
<div id="dashboard" class="screen" style="display:none">
<div class="back-btn" onclick="show('main')">â† Kembali</div>

<div class="sensor-card">
<div class="title">Dashboard Ringkas</div>
<div class="chart">
<div style="display:flex;justify-content:space-between;align-items:center">
<div>
<div style="font-size:13px;color:#666">Suhu</div>
<div style="font-weight:800;font-size:22px" id="dashTemp">--Â°C</div>
</div>
<div style="text-align:right">
<div style="font-size:13px;color:#666">Status Pam</div>
<div style="font-weight:800;font-size:22px;color:#2f7d32">ON</div>
</div>
</div>
</div>
</div>

<div class="sensor-card">
<div class="title">Ringkasan Tanah & Air</div>
<div style="margin-top:8px;color:#666">Monitor tanah, kelembapan & cahaya</div>
</div>

<div class="footer">Â© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>

<!-- MONITOR TANAMAN (full sensor charts) -->
<div id="plants" class="screen" style="display:none">
<div class="back-btn" onclick="show('main')">â† Kembali</div>

<div class="sensor-card">
<div style="overflow:hidden">
<div class="title" style="display:inline-block">Suhu (Â°C)</div>
<div class="value-badge" id="tempNow2">--Â°C</div>
</div>
<div class="subtitle">Updated setiap 3s</div>
<div class="chart"><canvas id="tempChart2"></canvas></div>
</div>

<div class="sensor-card">
<div style="overflow:hidden">
<div class="title" style="display:inline-block">Kelembapan (%)</div>
<div class="value-badge" id="humNow2">--%</div>
</div>
<div class="subtitle">Updated setiap 3s</div>
<div class="chart"><canvas id="humChart2"></canvas></div>
</div>

<div class="footer">Â© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>

<!-- DRONE -->
<div id="drone" class="screen" style="display:none">
<div class="back-btn" onclick="show('main')">â† Kembali</div>

<div class="sensor-card">
<div style="overflow:hidden">
<div class="title">Ketinggian</div>
<div class="value-badge" id="altNow">-- m</div>
</div>
<div class="chart"><canvas id="altChart"></canvas></div>
</div>

<div class="sensor-card">
<div style="overflow:hidden">
<div class="title">Kelajuan</div>
<div class="value-badge" id="speedNow">-- m/s</div>
</div>
<div class="chart"><canvas id="speedChart"></canvas></div>
</div>

<div class="sensor-card">
<div style="overflow:hidden">
<div class="title">Bateri</div>
<div class="value-badge" id="batNow">--%</div>
</div>
<div class="chart"><canvas id="batChart"></canvas></div>
</div>

<div class="footer">Â© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>

<!-- PUMP (ganti bahagian lama) -->
<div id="pump" class="screen" style="display:none">
<div class="back-btn" onclick="show('main')">â† Kembali</div>

<div class="sensor-card">
<div style="display:flex; justify-content:space-between; align-items:center">
<div>
<div class="title">Kawal Pam Air</div>
<div class="subtitle">Kawalan manual pam</div>
</div>
<div id="pumpStatus" style="font-weight:800; color:#2f7d32; background:#e9f4ea; padding:8px 12px; border-radius:10px">
OFF
</div>
</div>

<div style="margin-top:12px; display:flex; gap:10px">
<button id="btnPumpOn" class="btn" style="flex:1; background:#2f7d32;color:#fff;border:none;padding:12px" onclick="pump('ON')">
Hidupkan
</button>
<button id="btnPumpOff" class="btn" style="flex:1; background:#fff;color:#2f7d32;border:3px solid #2f7d32;padding:12px" onclick="pump('OFF')">
Matikan
</button>
</div>
</div>

<div class="footer">Â© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>
<!-- SENSOR simple charts (alternate) -->
<div id="sensor" class="screen" style="display:none">
<div class="back-btn" onclick="show('main')">â† Kembali</div>

<div class="sensor-card">
<div style="overflow:hidden">
<div class="title">Suhu (Â°C)</div>
<div class="value-badge" id="tempNow">--Â°C</div>
</div>
<div class="subtitle">Updated setiap 3s</div>
<div class="chart"><canvas id="tempChart"></canvas></div>
</div>

<div class="sensor-card">
<div style="overflow:hidden">
<div class="title">Kelembapan (%)</div>
<div class="value-badge" id="humNow">--%</div>
</div>
<div class="subtitle">Updated setiap 3s</div>
<div class="chart"><canvas id="humChart"></canvas></div>
</div>

<div class="footer">Â© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>

<!-- STOCK, SALES placeholders (kept simple) -->
<div id="stock" class="screen" style="display:none">
<div class="back-btn" onclick="show('main')">â† Kembali</div>
<div class="sensor-card"><div class="title">Stok Tanaman</div></div>
<div class="footer">Â© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>

<div id="sales" class="screen" style="display:none">
<div class="back-btn" onclick="show('main')">â† Kembali</div>
<div class="sensor-card"><div class="title">Jualan</div></div>
<div class="footer">Â© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>

</div> <!-- /container -->

<script>
/* ---------- navigation ---------- */
function show(id){
document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
const el = document.getElementById(id);
if(el) el.style.display = 'block';
// small scroll to top for mobile
window.scrollTo({top:0,behavior:'smooth'});
}

/* ---------- theme (simple) ---------- */
function setTheme(v){
document.body.setAttribute('data-theme', v);
// more theme handling could go here
}

/* ---------- sensor simulation data ---------- */
let tempData = [25,26,27,27,28,28,29];
let humData = [60,61,62,63,62,61,60];

/* dashboard / sensor rendering helpers */
function drawLine(canvas, data, color){
if(!canvas) return;
const ctx = canvas.getContext('2d');
const w = canvas.width = canvas.offsetWidth;
const h = canvas.height = 70;
ctx.clearRect(0,0,w,h);
ctx.lineWidth = 2;
ctx.strokeStyle = color;
const max = Math.max(...data), min = Math.min(...data);
ctx.beginPath();
data.forEach((v,i)=>{
const x = i/(data.length-1 || 1)*(w-10)+5;
const y = h - ((v-min)/( (max-min) || 1))*(h-20) - 10;
if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
});
ctx.stroke();
// fill area
ctx.lineTo(w-5,h-6);
ctx.lineTo(5,h-6);
ctx.closePath();
ctx.fillStyle = color + "22";
ctx.fill();

// points
ctx.fillStyle = color;
data.forEach((v,i)=>{
const x = i/(data.length-1 || 1)*(w-10)+5;
const y = h - ((v-min)/( (max-min) || 1))*(h-20) - 10;
ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
});
}

// lighter separate function for second charts (same behaviour)
function drawLine2(canvas, data, color){ drawLine(canvas,data,color); }

/* ---------- sensor tick (main) ---------- */
function tickSensors(){
// push new random-ish values
let lastT = tempData[tempData.length-1] || 26;
let lastH = humData[humData.length-1] || 60;
tempData.push( Math.max(15, Math.min(40, +(lastT + (Math.random()-0.5)*1.6).toFixed(1))) );
humData.push( Math.max(10, Math.min(100, +(lastH + (Math.random()-0.5)*2.4).toFixed(1))) );

if(tempData.length>12) tempData.shift();
if(humData.length>12) humData.shift();

// update single sensor page + dashboard
document.getElementById('tempNow').textContent = tempData[tempData.length-1].toFixed(1) + "Â°C";
document.getElementById('humNow').textContent = humData[humData.length-1].toFixed(1) + "%";
document.getElementById('dashTemp').textContent = tempData[tempData.length-1].toFixed(1) + "Â°C";

// monitor tanaman (second set)
if(document.getElementById('tempNow2')){
document.getElementById('tempNow2').textContent = tempData[tempData.length-1].toFixed(1)+"Â°C";
document.getElementById('humNow2').textContent = humData[humData.length-1].toFixed(1)+"%";
}

// draw charts (safe guard)
try{
drawLine(document.getElementById('tempChart'), tempData, '#2e7d32');
drawLine(document.getElementById('humChart'), humData, '#2e7d32');
drawLine2(document.getElementById('tempChart2'), tempData, '#2e7d32');
drawLine2(document.getElementById('humChart2'), humData, '#2e7d32');
}catch(e){ /* ignore */ }
}

setInterval(tickSensors, 3000);
window.addEventListener('load', ()=>{
setTimeout(()=>{ tickSensors(); }, 200);
});

/* ---------- drone simulation ---------- */
let altData = [120,125,130,128,135,140];
let speedData = [10,11,9,12,11,10];
let batData = [95,93,92,90,89];

function tickDrone(){
// random walk
const lastAlt = altData[altData.length-1] || 120;
altData.push(Math.max(5, Math.min(500, +(lastAlt + (Math.random()-0.5)*6).toFixed(0))));
if(altData.length>12) altData.shift();

const lastSp = speedData[speedData.length-1] || 10;
speedData.push(Math.max(0, +(lastSp + (Math.random()-0.5)*2).toFixed(1)));
if(speedData.length>12) speedData.shift();

const lastBat = batData[batData.length-1] || 95;
batData.push(Math.max(0, +(lastBat - Math.random()*0.8).toFixed(0)));
if(batData.length>12) batData.shift();

// update UI
if(document.getElementById('altNow')) document.getElementById('altNow').textContent = altData[altData.length-1] + " m";
if(document.getElementById('speedNow')) document.getElementById('speedNow').textContent = speedData[speedData.length-1] + " m/s";
if(document.getElementById('batNow')) document.getElementById('batNow').textContent = batData[batData.length-1] + "%";

try{
drawLine(document.getElementById('altChart'), altData, '#2e7d32');
drawLine(document.getElementById('speedChart'), speedData, '#2e7d32');
drawLine(document.getElementById('batChart'), batData, '#2e7d32');
}catch(e){}
}
setInterval(tickDrone, 1200);

/* ---------- pump control (demo) ---------- */
function pump(state){
alert('Pam ' + state);
// here you would call your API to toggle the real pump
}

/* ---------- small helpers / responsive redraw on resize ---------- */
window.addEventListener('resize', ()=>{
// redraw charts on resize
try{
drawLine(document.getElementById('tempChart'), tempData, '#2e7d32');
drawLine(document.getElementById('humChart'), humData, '#2e7d32');
drawLine2(document.getElementById('tempChart2'), tempData, '#2e7d32');
drawLine2(document.getElementById('humChart2'), humData, '#2e7d32');
drawLine(document.getElementById('altChart'), altData, '#2e7d32');
drawLine(document.getElementById('speedChart'), speedData, '#2e7d32');
drawLine(document.getElementById('batChart'), batData, '#2e7d32');
}catch(e){}
});

/* ---------- register service worker ---------- */
if('serviceWorker' in navigator){
navigator.serviceWorker.register('sw.js').then(()=> {
console.log('sw registered');
}).catch(e=> console.warn('sw fail', e));
}
</script>

</body>
</html>
