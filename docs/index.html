<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#2f7d32" />
  <link rel="manifest" href="./manifest.json">
  <title>MY TANI</title>

  <style>
  :root{
    --accent:#2f7d32;
    --accent-dark:#23561a;
    --muted:#6b6f6b;
    --card:#ffffff;
    --radius:12px;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; -webkit-font-smoothing:antialiased;}
  body{background:transparent; color:#0b2540;}

  /* Fullscreen blurred background (fixed). Uses bg.jpg.JPG in /docs */
  .bg-hero {
    position:fixed; inset:0; z-index:-2;
    background-image: url('./bg.jpg.JPG'); /* <-- change filename if needed */
    background-position:center center;
    background-size:cover;
    background-repeat:no-repeat;
    filter: brightness(0.55) blur(1.2px);
    transform: translateZ(0);
  }
  .bg-overlay {
    position:fixed; inset:0; z-index:-1;
    background: linear-gradient(rgba(0,0,0,0.02), rgba(0,0,0,0.04));
  }

  /* Layout */
  .app { min-height:100vh; display:flex; flex-direction:column; }
  header.site-header { background:var(--accent); color:#fff; padding:20px 14px; text-align:center; }
  header .brand { font-weight:800; font-size:28px; }
  header .tag { font-size:13px; opacity:0.95; margin-top:6px; }

  main.container { flex:1; width:100%; max-width:920px; margin:0 auto; padding:14px; box-sizing:border-box; }

  .back-wrap { display:none; margin-bottom:12px; }
  .back-btn {
    display:flex; align-items:center; gap:8px; padding:12px 14px; border-radius:14px;
    border:3px dashed rgba(47,125,50,0.9); background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.9));
    color:var(--accent); font-weight:700; cursor:pointer;
  }

  .card { background:var(--card); border-radius:var(--radius); padding:14px; box-shadow:0 10px 26px rgba(3,10,10,0.06); margin-bottom:14px; }

  .btn { display:block; width:100%; text-align:left; padding:14px; border-radius:12px; border:3px solid var(--accent); background:transparent; color:var(--accent); font-weight:800; font-size:18px; margin-bottom:12px; cursor:pointer; }
  .btn small { display:block; color:var(--muted); font-weight:500; margin-top:6px; font-size:13px; }

  .chart { padding:10px 6px; }
  canvas { width:100%; height:80px; display:block; border-radius:8px; }

  .pill { float:right; background:var(--accent); color:#fff; padding:8px 12px; border-radius:12px; font-weight:800; box-shadow:0 2px 6px rgba(0,0,0,0.12); }
  .muted { color:var(--muted); font-size:13px; }

  footer.site-foot { text-align:center; color:var(--muted); padding:22px 0; font-size:13px; }

  /* responsive tweaks */
  @media(min-width:800px){
    main.container { padding:24px; }
    canvas { height:100px; }
  }
  </style>
</head>
<body>
  <!-- Background -->
  <div class="bg-hero" aria-hidden="true"></div>
  <div class="bg-overlay" aria-hidden="true"></div>

  <div class="app">
    <header class="site-header">
      <div class="brand">MY TANI</div>
      <div class="tag">Ladang Pintar Di Hujung Jari Anda</div>
    </header>

    <main class="container">
      <!-- Back button wrapper (hidden on home) -->
      <div id="backWrap" class="back-wrap">
        <div class="back-btn" id="backBtn" role="button" aria-label="Kembali">
          <span style="font-size:18px">‚Üê</span> <span>Kembali</span>
        </div>
      </div>

      <!-- HOME screen -->
      <section id="home" class="screen" aria-label="Home">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:800;font-size:18px">Dashboard Ringkas</div>
              <div class="muted" style="margin-top:6px">Pilih fungsi di bawah</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:900;color:#fff;background:var(--accent-dark);padding:8px 12px;border-radius:10px;">LIVE</div>
            </div>
          </div>
        </div>

        <button class="btn" onclick="nav('monitor')">üì° Monitor Tanaman <small>Senarai tanaman & ringkasan</small></button>
        <button class="btn" onclick="nav('drone')">üöÅ Monitor Drone <small>Animasi & telemetry</small></button>
        <button class="btn" onclick="nav('pump')">üíß Kawal Pam Air <small>Butang ON / OFF</small></button>
        <button class="btn" onclick="nav('sensor')">üå°Ô∏è Suhu & Kelembapan <small>Grafik live</small></button>
      </section>

      <!-- MONITOR page -->
      <section id="monitor" class="screen" style="display:none">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800;font-size:18px">Monitor Tanaman</div>
            <div class="pill" id="pumpPill">OFF</div>
          </div>
          <div class="muted" style="margin-top:8px">Ringkasan & status zon</div>
        </div>

        <div class="card">
          <div style="font-weight:800">Zona A ‚Äî Kebun</div>
          <div class="muted" style="margin-top:6px">Suhu & kelembapan ringkas</div>
          <div style="display:flex;gap:12px;margin-top:12px">
            <div style="flex:1">
              <div class="muted">Suhu</div>
              <div style="font-size:26px;font-weight:800">29.2 ¬∞C</div>
            </div>
            <div style="flex:1">
              <div class="muted">Kelembapan</div>
              <div style="font-size:26px;font-weight:800">57 %</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px 0">Monitor Tanah</h3>
          <div class="muted">Cahaya, kelembapan tanah & pH (contoh)</div>
          <div style="height:120px;margin-top:12px;background:linear-gradient(#fff,#f7f7f7);border-radius:10px"></div>
        </div>
      </section>

      <!-- DRONE -->
      <section id="drone" class="screen" style="display:none">
        <div class="card">
          <div style="font-weight:800;font-size:18px">Monitor Drone</div>
          <div class="muted" style="margin-top:6px">Animasi drone & telemetry (simulated)</div>
        </div>
        <div class="card">
          <div class="muted">Telemetry</div>
          <div style="margin-top:8px">Altitude: <strong id="altVal">--</strong> m &nbsp;|&nbsp; Speed: <strong id="spdVal">--</strong> m/s &nbsp;|&nbsp; Battery: <strong id="batVal">--</strong>%</div>
          <div style="margin-top:12px">
            <button style="padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:800;cursor:pointer" onclick="simulateDrone()">Start Sim</button>
          </div>
        </div>
      </section>

      <!-- PUMP -->
      <section id="pump" class="screen" style="display:none">
        <div class="card">
          <div style="font-weight:800;font-size:18px">Kawal Pam Air</div>
          <div class="muted" style="margin-top:6px">Tekan butang untuk hidup / matikan pam</div>
        </div>

        <div class="card" style="display:flex;flex-direction:column;gap:12px;align-items:center">
          <div id="pumpStatusLarge" style="font-weight:900;font-size:28px;color:var(--accent-dark)">OFF</div>
          <div style="display:flex;gap:12px;width:100%">
            <button id="btnPumpOn" style="flex:1;padding:12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:800;cursor:pointer" onclick="setPump('ON')">HIDUPKAN PAM</button>
            <button id="btnPumpOff" style="flex:1;padding:12px;border-radius:10px;border:1px solid #ddd;background:#fff;color:#333;cursor:pointer" onclick="setPump('OFF')">MATIKAN PAM</button>
          </div>
        </div>
      </section>

      <!-- SENSOR -->
      <section id="sensor" class="screen" style="display:none">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800;font-size:18px">Suhu (¬∞C)</div>
            <div class="pill" id="tempNow">--¬∞C</div>
          </div>
          <div class="chart" style="margin-top:10px"><canvas id="tempChart"></canvas></div>
        </div>

        <div class="card" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800;font-size:18px">Kelembapan (%)</div>
            <div class="pill" id="humNow">--%</div>
          </div>
          <div class="chart" style="margin-top:10px"><canvas id="humChart"></canvas></div>
        </div>
      </section>

      <footer class="site-foot">¬© 2020 Hana AgroTech Sdn. Bhd.</footer>
    </main>
  </div>

  <script>
    // ---------- Navigation ----------
    function nav(id){
      // hide backWrap on home
      const backWrap = document.getElementById('backWrap');
      if(id === 'home'){
        document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
        document.getElementById('home').style.display = 'block';
        backWrap.style.display = 'none';
      } else {
        document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
        const el = document.getElementById(id);
        if(el) el.style.display = 'block';
        backWrap.style.display = 'block';
      }
      // update pump pill if present
      updatePumpUI();
    }

    // Back button click
    document.getElementById('backBtn').addEventListener('click', function(){ nav('home'); });

    // initial: show home
    nav('home');

    // ---------- Pump control (simulated) ----------
    let pumpState = 'OFF';
    function setPump(state){
      pumpState = (state === 'ON') ? 'ON' : 'OFF';
      updatePumpUI();
      // if real API exists, replace with fetch POST:
      // fetch('/api/pump', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({state})});
    }
    function updatePumpUI(){
      const pill = document.getElementById('pumpPill');
      if(pill) pill.textContent = pumpState;
      const big = document.getElementById('pumpStatusLarge');
      if(big) big.textContent = pumpState;
      // update styling if desired
      if(pumpState==='ON'){
        document.getElementById('btnPumpOn').style.opacity = '0.8';
        document.getElementById('btnPumpOff').style.opacity = '1';
      } else {
        document.getElementById('btnPumpOn').style.opacity = '1';
        document.getElementById('btnPumpOff').style.opacity = '0.8';
      }
    }

    // ---------- Drone simulation ----------
    function simulateDrone(){
      let alt = 120, sp = 12, bat = 89;
      const id = setInterval(()=>{
        alt = Math.max(2, Math.round((alt + (Math.random()-0.5)*8)*10)/10);
        sp = Math.max(0.5, Math.round((sp + (Math.random()-0.5)*4)*10)/10);
        bat = Math.max(1, Math.round((bat - Math.random()*1.2)*10)/10);
        document.getElementById('altVal').textContent = alt;
        document.getElementById('spdVal').textContent = sp;
        document.getElementById('batVal').textContent = bat;
        if(bat < 5){ clearInterval(id); }
      }, 800);
      setTimeout(()=>clearInterval(id), 12000);
    }

    // ---------- Charts (vanilla canvas) ----------
    function drawLine(canvas, data, color){
      if(!canvas) return;
      const ctx = canvas.getContext('2d');
      const DPR = window.devicePixelRatio || 1;
      const w = canvas.clientWidth;
      const h = canvas.clientHeight;
      canvas.width = Math.round(w * DPR);
      canvas.height = Math.round(h * DPR);
      ctx.scale(DPR, DPR);
      ctx.clearRect(0,0,w,h);

      const max = Math.max(...data), min = Math.min(...data);
      ctx.beginPath();
      data.forEach((v,i)=>{
        const x = (i/(data.length-1)) * (w - 10) + 5;
        const y = h - ((v - min) / ((max-min) || 1)) * (h - 18) - 9;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.lineWidth = 3;
      ctx.strokeStyle = color;
      ctx.lineJoin = 'round';
      ctx.lineCap = 'round';
      ctx.stroke();

      // fill under curve
      ctx.lineTo(w - 5, h - 6);
      ctx.lineTo(5, h - 6);
      ctx.closePath();
      ctx.fillStyle = hexToRgba(color, 0.08);
      ctx.fill();

      // draw points
      ctx.fillStyle = color;
      data.forEach((v,i)=>{
        const x = (i/(data.length-1)) * (w - 10) + 5;
        const y = h - ((v - min) / ((max-min) || 1)) * (h - 18) - 9;
        ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
      });
    }
    function hexToRgba(hex, a){
      const h = hex.replace('#','');
      const r = parseInt(h.substring(0,2),16), g = parseInt(h.substring(2,4),16), b = parseInt(h.substring(4,6),16);
      return `rgba(${r},${g},${b},${a})`;
    }

    // sensor data simulation
    let tempData = [25,26,27,27.5,28,28.3,28.8];
    let humData = [55,58,60,62,63.2,62,61];

    function tickSensors(){
      tempData.push(Math.round((tempData[tempData.length-1] + (Math.random()-0.5)*1.2)*10)/10);
      humData.push(Math.round((humData[humData.length-1] + (Math.random()-0.5)*2.2)*10)/10);
      if(tempData.length>12) tempData.shift();
      if(humData.length>12) humData.shift();

      // update pills
      const t = tempData[tempData.length-1];
      const h = humData[humData.length-1];
      const tempNow = document.getElementById('tempNow');
      const humNow = document.getElementById('humNow');
      if(tempNow) tempNow.textContent = t.toFixed(1) + '¬∞C';
      if(humNow) humNow.textContent = h.toFixed(1) + '%';

      // draw where present
      drawLine(document.getElementById('tempChart'), tempData, '#2f7d32');
      drawLine(document.getElementById('humChart'), humData, '#2f7d32');
    }

    // start sensors
    window.addEventListener('load', ()=>{
      // initial render
      tickSensors();
      setInterval(tickSensors, 3000);

      // register service worker if exists
      if('serviceWorker' in navigator){
        navigator.serviceWorker.register('sw.js').then(()=> {
          console.log('sw registered');
        }).catch(err=>{
          console.log('sw register failed', err);
        });
      }
    });

    // ensure navigation initial
    nav('home');
  </script>

</body>
</html>
