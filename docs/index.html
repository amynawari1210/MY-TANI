<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#2f7d32" />
  <link rel="manifest" href="manifest.json" />
  <title>MY TANI</title>

  <style>
    :root{
      --accent:#2f7d32;
      --card:#fff;
      --bg:#f2f2f2;
      --muted:#666;
      --text:#0b2540;
      --green-soft: #e8f5e1;
    }
    html,body{margin:0;padding:0;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--text);}
    .header{background:var(--accent); color:#fff; padding:18px 16px; text-align:center}
    .title{font-weight:800; font-size:28px; letter-spacing:1px}
    .subtitle{font-size:13px; opacity:0.95}
    .container{max-width:760px;margin:14px auto;padding:0 14px}
    .back-btn{border:3px dashed #2f7d32;border-radius:12px;padding:16px; color:var(--accent); display:inline-block;margin-bottom:14px; cursor:pointer}
    .card{background:var(--card); border-radius:12px;padding:14px;margin-bottom:14px; box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .big-btn{background: #cfecca; padding:18px;text-align:center;border-radius:6px;font-weight:700;color:var(--text);cursor:pointer}
    .big-btn.small{padding:10px;font-size:13px}
    .footer{padding:28px 0;text-align:center;color:var(--muted)}
    /* listing buttons (home) */
    .home-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:10px}
    .home-btn{background: #dff2d9;border-radius:8px;padding:14px;text-align:center;font-weight:700;cursor:pointer}
    .home-stats{background:#fff;border-radius:10px;padding:18px;font-weight:700; box-shadow:0 6px 18px rgba(0,0,0,0.05)}
    /* charts */
    .chart{padding:8px 12px;}
    canvas{width:100%; height:70px; display:block;}
    .badge{background:var(--accent);color:#fff;padding:6px 10px;border-radius:12px;float:right;font-weight:700}
    /* screens (show/hide) */
    .screen{display:none}
    .active{display:block}
    /* back icon small */
    .back-icon{font-size:20px;margin-right:6px;vertical-align:middle}
    /* mobile adjustments */
    @media(min-width:800px){
      .container{padding:0 32px}
      canvas{height:90px}
    }
  </style>
</head>
<body data-theme="green">
  <div class="header">
    <div class="title">MY TANI</div>
    <div class="subtitle">Ladang Pintar Di Hujung Jari Anda</div>
  </div>

  <div class="container">
    <!-- BACK (shared) -->
    <div id="backWrap" class="back-btn" onclick="show('home')">
      <span class="back-icon">←</span> Kembali
    </div>

    <!-- HOME -->
    <div id="home" class="screen active">
      <div class="card home-stats">
        <div style="font-size:18px;font-weight:800">Dashboard Ringkas</div>
      </div>

      <div class="home-grid">
        <div class="home-btn" onclick="show('monitor-tanaman')">Jenis Sayuran</div>
        <div class="home-btn" onclick="show('monitor-drone')">Jenis Buah-buahan</div>
        <div class="home-btn" onclick="show('sensor')">Kelembapan Tanah</div>
        <div class="home-btn" onclick="show('pump')">PH Air</div>
        <div class="home-btn" onclick="show('sales')">Siraman Baja</div>
        <div class="home-btn" onclick="show('stock')">Stok Tanaman</div>
        <div class="home-btn" onclick="show('health')">Kesihatan Tanaman</div>
        <div class="home-btn" onclick="show('sales')">Rekod Belian & Jualan</div>
      </div>
    </div>

    <!-- MONITOR TANAMAN -->
    <div id="monitor-tanaman" class="screen card">
      <div style="margin-bottom:10px;font-weight:800;font-size:20px">Dashboard Ringkas</div>

      <div class="card chart">
        <div style="font-weight:800">Suhu (°C) <span class="badge" id="tempBadge">28.4°C</span></div>
        <canvas id="tempChart"></canvas>
      </div>

      <div class="card chart">
        <div style="font-weight:800">Kelembapan (%) <span class="badge" id="humBadge">63.2%</span></div>
        <canvas id="humChart"></canvas>
      </div>
    </div>

    <!-- MONITOR DRONE -->
    <div id="monitor-drone" class="screen card">
      <div style="font-weight:800;font-size:20px;margin-bottom:10px">Drone</div>
      <div class="card">Animasi drone & telemetry (contoh)</div>
    </div>

    <!-- PUMP CONTROL -->
    <div id="pump" class="screen card">
      <div style="font-weight:800;font-size:20px;margin-bottom:10px">Kawal Pam Air</div>
      <div style="display:flex;gap:12px">
        <button id="pumpBtn" class="big-btn" onclick="togglePump()">ON</button>
        <div style="flex:1" class="card">
          Status Pam: <span id="pumpStatus">ON</span><br/><small class="muted">Tekan untuk togol</small>
        </div>
      </div>
    </div>

    <!-- SENSOR (suhu/kelembapan page simplified) -->
    <div id="sensor" class="screen card">
      <div style="font-weight:800;font-size:20px;margin-bottom:10px">Sensor</div>
      <div class="card">Data sensor ringkas (contoh) — suhu & kelembapan dipaparkan di halaman lain juga.</div>
    </div>

    <!-- STOCK -->
    <div id="stock" class="screen card">
      <div style="font-weight:800;font-size:20px;margin-bottom:10px">Stok Tanaman</div>
      <div id="stockTable" class="card">Tiada data (contoh).</div>
    </div>

    <!-- SALES -->
    <div id="sales" class="screen card">
      <div style="font-weight:800;font-size:20px;margin-bottom:10px">Jualan</div>
      <div class="card">Rekod belian & jualan — contoh ringkas.</div>
    </div>

    <!-- HEALTH -->
    <div id="health" class="screen card">
      <div style="font-weight:800;font-size:20px;margin-bottom:10px">Kesihatan Tanaman</div>
      <div class="card">Panduan ringkas — contoh.</div>
    </div>

    <div class="footer">© 2025 Hana AgroTech Sdn. Bhd.</div>
  </div>

  <script>
    // Navigation: show screen by id
    function show(id){
      document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
      const el = document.getElementById(id);
      if(el) el.classList.add('active');
      // hide back button on home
      document.getElementById('backWrap').style.display = (id === 'home') ? 'none' : 'inline-block';
      // if showing monitor-tanaman, (re)draw charts
      if(id==='monitor-tanaman'){ drawCharts(); }
    }

    // pump toggle
    let pumpOn = true;
    function togglePump(){
      pumpOn = !pumpOn;
      document.getElementById('pumpBtn').textContent = pumpOn ? 'ON' : 'OFF';
      document.getElementById('pumpStatus').textContent = pumpOn ? 'ON' : 'OFF';
      // simulate action (alert optional)
      // alert('Pam ' + (pumpOn ? 'HIDUP' : 'MATI'));
    }

    // small chart draw helper (vanilla canvas)
    function drawLine(canvas, data, color){
      if(!canvas) return;
      const ctx = canvas.getContext('2d');
      const w = canvas.offsetWidth;
      const h = canvas.offsetHeight;
      canvas.width = w*devicePixelRatio;
      canvas.height = h*devicePixelRatio;
      ctx.scale(devicePixelRatio, devicePixelRatio);
      ctx.clearRect(0,0,w,h);
      // fill area
      const max = Math.max(...data);
      const min = Math.min(...data);
      ctx.beginPath();
      data.forEach((v,i)=>{
        const x = i/(data.length-1)*(w-8) + 4;
        const y = h - ((v - min) / (max - min || 1))*(h-12) - 6;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.lineWidth = 2;
      ctx.strokeStyle = color;
      ctx.stroke();
      // fill under curve
      ctx.lineTo(w-4,h-6);
      ctx.lineTo(4,h-6);
      ctx.closePath();
      ctx.fillStyle = 'rgba(47,125,50,0.09)';
      ctx.fill();
    }

    // sample data & periodic update
    let tempData = [25,26,27,27,28,28,29];
    let humData = [55,58,60,62,63,61,60];

    function tickSensors(){
      // random walk
      tempData.push(Math.max(18, Math.min(40, Math.round((tempData[tempData.length-1] + (Math.random()-0.5)*1.8)*10)/10 )));
      humData.push(Math.max(20, Math.min(100, Math.round((humData[humData.length-1] + (Math.random()-0.5)*2.5)*10)/10 )));
      if(tempData.length>12) tempData.shift();
      if(humData.length>12) humData.shift();
      // update badges
      document.getElementById('tempBadge').textContent = tempData[tempData.length-1] + '°C';
      document.getElementById('humBadge').textContent = humData[humData.length-1] + '%';
      drawCharts();
    }

    function drawCharts(){
      drawLine(document.getElementById('tempChart'), tempData, '#2f7d32');
      drawLine(document.getElementById('humChart'), humData, '#2f7d32');
    }

    // init
    window.addEventListener('load', ()=>{
      // initial state: hide back on home
      show('home');
      // start ticking
      setInterval(tickSensors, 3000);
      tickSensors();
    });

    // register service worker
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js').catch(e=>console.log('sw fail',e));
    }
  </script>
</body>
</html>
