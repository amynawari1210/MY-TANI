<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#2f7d32" />
 <link rel="manifest" href="manifest.json">
  <title>MY TANI</title>
<meta name="apple-mobile-web-app-title" content="MY TANI">
  <style>
    :root{
      --bg: #f2f2f2;
      --accent: #2f7d32;
      --card: #fff;
      --text: #0b2540;
      --muted: #666;
    }
    [data-theme="brown"]{
      --accent:#8d6e63;
      --bg: #fbf7f4;
      --card: #fff9f6;
    }
    [data-theme="white"]{
      --accent:#3b7a57;
      --bg:#ffffff;
      --card:#ffffff;
    }

    *{box-sizing:border-box}
    body{
      margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
      background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;
    }
    .header{
      background:var(--accent); color:white; padding:18px 14px; text-align:center;
    }
    .title{ font-size:22px; font-weight:700; letter-spacing:1px }
    .subtitle{ font-size:13px; opacity:0.95; margin-top:4px }

    .container{ padding:14px; max-width:820px; margin:0 auto; }

    .btn{
      display:block; width:100%; background:var(--card); border:2px solid var(--accent);
      color:var(--accent); text-align:left; padding:14px; margin:10px 0; border-radius:12px;
      font-size:18px; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }
    .btn small{ display:block; color:var(--muted); font-size:12px; margin-top:6px }

    /* screens */
    .screen{ display:none; padding:10px 0; }
    .active{ display:block; }

    /* drone animation */
    .drone-stage{ height:260px; background:linear-gradient(#e8fef0, #f7fff9); border-radius:12px; position:relative; overflow:hidden; margin-bottom:14px; border:1px solid rgba(0,0,0,0.04); }
    .drone{ position:absolute; left:10%; top:60%; width:110px; transform-origin:center; animation:fly 6s infinite ease-in-out; }
    .drone .body{ width:100px; height:34px; background:var(--accent); border-radius:8px; color:white; display:flex; align-items:center; justify-content:center; font-weight:700; }
    .rotor{ width:34px; height:6px; background:rgba(0,0,0,0.12); border-radius:50px; position:absolute; top:0; left:0; transform-origin:center; animation:rot 0.15s linear infinite; }
    .rotor.r2{ left:auto; right:0 }
    @keyframes rot{ from{ transform:rotate(0) } to{ transform:rotate(360deg) } }
    @keyframes fly{
      0%{ transform: translate(0,0) rotate(0deg) }
      25%{ transform: translate(60px,-80px) rotate(-6deg) }
      50%{ transform: translate(140px,0) rotate(2deg) }
      75%{ transform: translate(60px,60px) rotate(6deg) }
      100%{ transform: translate(0,0) rotate(0deg) }
    }
    .drone-telemetry{ padding:10px; display:flex; gap:12px; justify-content:space-between; }
    .tele-card{ background:var(--card); border-radius:8px; padding:10px; flex:1; text-align:center; border:1px solid rgba(0,0,0,0.04) }

    /* charts */
    .chart{ background:var(--card); padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,0.04); margin-bottom:12px; }
    canvas{ width:100%; height:160px; display:block; }

    /* stock table */
    table{ width:100%; border-collapse:collapse; background:var(--card); border-radius:8px; overflow:hidden; }
    table th, table td{ padding:10px; text-align:left; border-bottom:1px solid #eee; }
    .badge{ background:var(--accent); color:white; padding:6px 8px; border-radius:8px; font-weight:600; }

    /* invoice */
    .invoice{ background:var(--card); padding:12px; border-radius:12px; border:1px solid rgba(0,0,0,0.04); margin-bottom:12px; }
    .row{ display:flex; justify-content:space-between; margin:6px 0; }
    .muted{ color:var(--muted); font-size:13px }

    /* loading */
    .loading{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.9); z-index:9999; }
    .loader{ width:120px; height:120px; border-radius:12px; background:var(--card); display:flex; align-items:center; justify-content:center; box-shadow:0 10px 30px rgba(0,0,0,0.06); }
    .dot{ width:14px; height:14px; background:var(--accent); border-radius:50%; margin:6px; animation:pop 0.9s infinite; display:inline-block }
    .dot:nth-child(2){ animation-delay:0.1s }
    .dot:nth-child(3){ animation-delay:0.2s }
    @keyframes pop{ 0%{ transform:translateY(0) } 50%{ transform:translateY(-12px) } 100%{ transform:translateY(0) } }

    /* footer small */
    .footer{ padding:12px; text-align:center; color:var(--muted); font-size:13px; margin-top:10px }
    .top-controls{ display:flex; gap:8px; justify-content:flex-end; margin-bottom:10px }

    /* theme buttons */
    .theme-btn{ padding:8px 10px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:var(--card); font-weight:600; cursor:pointer }
  </style>
</head>
<body data-theme="green">

<div class="loading" id="loading">
  <div class="loader">
    <div style="text-align:center">
      <div style="font-weight:700; margin-bottom:8px">MY TANI</div>
      <div><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
      <div style="font-size:12px; margin-top:8px; color:var(--muted)">Memuatkan data demo‚Ä¶</div>
    </div>
  </div>
</div>

<div class="header">
  <div class="title">MY TANI</div>
  <div class="subtitle">Ladang Pintar Di Hujung Jari Anda</div>
</div>

<div class="container">
  <div class="top-controls">
    <select id="theme" class="theme-btn" onchange="setTheme(this.value)">
      <option value="green">Theme: Green</option>
      <option value="brown">Theme: Brown</option>
      <option value="white">Theme: White</option>
    </select>
  </div>

  <!-- HOME -->
  <div id="home" class="screen active">
    <button class="btn" onclick="show('drone')">üì° Monitor Tanaman <small>Tap untuk lihat ringkasan</small></button>
    <button class="btn" onclick="show('drone')">üöÅ Monitor Drone <small>Animasi drone & telemetry</small></button>
    <button class="btn" onclick="show('pump')">üíß Kawal Pam Air <small>Tekan ON/OFF untuk kawalan pam</small></button>
    <button class="btn" onclick="show('sensor')">üå° Suhu & Kelembapan <small>Graf sensor live</small></button>
    <button class="btn" onclick="show('stock')">üì¶ Stok Tanaman <small>Table & graf</small></button>
    <button class="btn" onclick="show('sales')">üõí Jualan <small>Invoice card & ringkasan</small></button>
  </div>

  <!-- DRONE -->
  <div id="drone" class="screen">
    <button class="btn" onclick="show('home')" style="border-style: dashed; margin-bottom:12px">‚Üê Kembali</button>
    <div class="drone-stage">
      <div class="drone" id="droneEl" style="transform:translate(0,0)">
        <div class="body">DRONE</div>
        <div class="rotor" style="left:-10px; top:-12px"></div>
        <div class="rotor r2" style="right:-10px; top:-12px"></div>
      </div>
    </div>
    <div class="drone-telemetry">
      <div class="tele-card">Altitude<br><strong id="alt">120 m</strong></div>
      <div class="tele-card">Speed<br><strong id="spd">12 km/h</strong></div>
      <div class="tele-card">Battery<br><strong id="bat">89%</strong></div>
    </div>
    <div style="margin-top:10px">
      <button class="btn" onclick="simulateDrone()">Simulate Route</button>
      <button class="btn" onclick="alert('Live feed not available in demo')">Open Camera Feed</button>
    </div>
  </div>

  <!-- PUMP -->
  <div id="pump" class="screen">
    <button class="btn" onclick="show('home')" style="border-style: dashed; margin-bottom:12px">‚Üê Kembali</button>
    <div class="invoice">
      <div class="row"><div class="muted">Status Pam</div><div id="pumpState" class="badge">MATI</div></div>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button class="btn" style="flex:1" onclick="pump('ON')">ON</button>
        <button class="btn" style="flex:1" onclick="pump('OFF')">OFF</button>
      </div>
    </div>
  </div>

  <!-- SENSOR -->
  <div id="sensor" class="screen">
    <button class="btn" onclick="show('home')" style="border-style: dashed; margin-bottom:12px">‚Üê Kembali</button>
    <div class="chart">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div><strong>Suhu (¬∞C)</strong><div class="muted">Updated setiap 3s</div></div>
        <div><span class="badge" id="tempNow">28¬∞C</span></div>
      </div>
      <canvas id="tempChart"></canvas>
    </div>

    <div class="chart">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div><strong>Kelembapan (%)</strong><div class="muted">Updated setiap 3s</div></div>
        <div><span class="badge" id="humNow">62%</span></div>
      </div>
      <canvas id="humChart"></canvas>
    </div>
  </div>

  <!-- STOCK -->
  <div id="stock" class="screen">
    <button class="btn" onclick="show('home')" style="border-style: dashed; margin-bottom:12px">‚Üê Kembali</button>
    <div style="display:flex; gap:12px; margin-bottom:10px; align-items:center">
      <div style="flex:1">
        <table>
          <thead><tr><th>Produk</th><th>Stok (kg)</th><th>Harga/kg</th></tr></thead>
          <tbody id="stockTable"></tbody>
        </table>
      </div>
      <div style="width:36%; min-width:200px">
        <div class="chart"><canvas id="stockChart"></canvas></div>
      </div>
    </div>
  </div>

  <!-- SALES -->
  <div id="sales" class="screen">
    <button class="btn" onclick="show('home')" style="border-style: dashed; margin-bottom:12px">‚Üê Kembali</button>
    <div class="invoice">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div><strong>Jualan Hari Ini</strong><div class="muted">Menunjukkan ringkasan</div></div>
        <div class="badge">RM 480</div>
      </div>
      <div style="margin-top:12px">
        <div class="row"><div class="muted">Tempahan Baru</div><div><strong>6</strong></div></div>
        <div class="row"><div class="muted">Jumlah Bulanan</div><div><strong>RM 12,430</strong></div></div>
      </div>
    </div>

    <div class="invoice">
      <div style="font-weight:700">Invoice #MT-20251101</div>
      <div class="muted">Nama Pelanggan: Kampung Organik</div>
      <div style="margin-top:6px">
        <div class="row"><div>Bayam (20kg)</div><div>RM 60</div></div>
        <div class="row"><div>Sawi (10kg)</div><div>RM 30</div></div>
        <div class="row"><div><strong>Subtotal</strong></div><div><strong>RM 90</strong></div></div>
      </div>
    </div>
  </div>

  <div class="footer">¬© 2025 Hana AgroTech Sdn. Bhd.</div>
</div>

<script>
/* Navigation */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* Theme */
function setTheme(v){
  if(v==='brown') document.body.setAttribute('data-theme','brown');
  else if(v==='white') document.body.setAttribute('data-theme','white');
  else document.body.setAttribute('data-theme','green');
}

/* Simulated drone telemetry */
function simulateDrone(){
  const altEl=document.getElementById('alt'), spd=document.getElementById('spd'), bat=document.getElementById('bat');
  let alt=120, sp=12, battery=89;
  const id = setInterval(()=>{
    alt += (Math.random()-0.5)*12;
    sp += (Math.random()-0.5)*6;
    battery -= Math.random()*0.6;
    altEl.textContent = Math.max(5, Math.round(alt)) + ' m';
    spd.textContent = Math.max(1, Math.round(sp)) + ' km/h';
    bat.textContent = Math.max(5, Math.round(battery)) + '%';
  }, 900);
  setTimeout(()=>{ clearInterval(id); alert('Simulasi tamat') }, 9000);
}

/* Pump control */
function pump(state){
  const el=document.getElementById('pumpState');
  if(state==='ON'){ el.textContent='HIDUP'; el.style.background='green'; el.classList.remove('badge'); el.classList.add('badge'); localStorage.setItem('pump','on'); }
  else{ el.textContent='MATI'; el.style.background=''; localStorage.setItem('pump','off'); }
  alert('Pam ' + state);
}

/* Small chart helper (vanilla canvas) */
function drawLine(canvas, data, color){
  const ctx = canvas.getContext('2d');
  const w = canvas.width = canvas.offsetWidth;
  const h = canvas.height = canvas.offsetHeight;
  ctx.clearRect(0,0,w,h);
  ctx.lineWidth=2; ctx.strokeStyle=color; ctx.beginPath();
  const max = Math.max(...data), min = Math.min(...data);
  data.forEach((v,i)=>{
    const x = i/(data.length-1)*(w-10)+5;
    const y = h - ((v-min)/(max-min || 1))*(h-10)-5;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.stroke();
  // points
  ctx.fillStyle=color;
  data.forEach((v,i)=>{
    const x = i/(data.length-1)*(w-10)+5;
    const y = h - ((v-min)/(max-min || 1))*(h-10)-5;
    ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
  });
}

/* Sensor simulation */
let tempData = [25,26,27,27,28,28];
let humData = [60,61,62,63,62,62];
function tickSensors(){
  tempData.push( (tempData[tempData.length-1] + (Math.random()-0.4)*1.5).toFixed(1) );
  humData.push( Math.max(30, (humData[humData.length-1] + (Math.random()-0.4)*2).toFixed(1)) );
  if(tempData.length>12) tempData.shift();
  if(humData.length>12) humData.shift();
  document.getElementById('tempNow').textContent = tempData[tempData.length-1] + '¬∞C';
  document.getElementById('humNow').textContent = humData[humData.length-1] + '%';
  drawLine(document.getElementById('tempChart'), tempData.map(Number), '#ff6b6b');
  drawLine(document.getElementById('humChart'), humData.map(Number), '#4da6ff');
}
setInterval(tickSensors, 3000);

/* Stock table + small bar chart */
const stockItems = [
  {name:'Bayam', qty:120, price:2},
  {name:'Sawi', qty:80, price:3},
  {name:'Kangkung', qty:50, price:1.5},
  {name:'Tomato', qty:40, price:4},
];
function renderStock(){
  const tbody = document.getElementById('stockTable');
  tbody.innerHTML = '';
  stockItems.forEach(i=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i.name}</td><td>${i.qty} kg</td><td>RM ${i.price}</td>`;
    tbody.appendChild(tr);
  });
  // bar chart
  const canvas = document.getElementById('stockChart');
  const data = stockItems.map(s=>s.qty);
  drawBar(canvas, data, '#6aa84f');
}
function drawBar(canvas, data, color){
  const ctx = canvas.getContext('2d');
  const w = canvas.width = canvas.offsetWidth;
  const h = canvas.height = canvas.offsetHeight;
  ctx.clearRect(0,0,w,h);
  const max = Math.max(...data);
  const barW = (w/data.length)*0.6;
  data.forEach((v,i)=>{
    const x = i*(w/data.length) + (w/data.length - barW)/2;
    const barH = (v/max)*(h-20);
    ctx.fillStyle = color;
    ctx.fillRect(x, h - barH - 10, barW, barH);
    ctx.fillStyle = '#333'; ctx.font='12px Arial';
    ctx.fillText(v + 'kg', x, h - barH - 14);
  });
}

/* loading & init */
window.addEventListener('load', ()=>{
  setTimeout(()=>{ document.getElementById('loading').style.display='none'; }, 900);
  renderStock();
  tickSensors();
});

/* register service worker */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').catch(()=>{console.log('sw fail')});
}
</script>

</body>
</html>
