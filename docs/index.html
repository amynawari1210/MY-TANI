<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#2f7d32" />
  <link rel="manifest" href="manifest.json" />
  <title>MY TANI</title>

  <style>
    :root{
      --bg: #f2f2f2;
      --accent: #2f7d32;
      --card: #fff;
      --text: #0b2540;
      --muted: #666;
    }
    [data-theme="brown"]{ --accent:#8d6e63; --bg:#fbf7f4; --card:#fff9f6 }
    [data-theme="white"]{ --accent:#3b7a57; --bg:#ffffff; --card:#ffffff }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text);
    }

    .header{
      background:var(--accent);
      color:white;
      padding:18px 12px;
      text-align:center;
    }
    .title{ font-size:28px; font-weight:800; letter-spacing:1px }
    .subtitle{ font-size:14px; opacity:0.95 }

    .container{ padding:14px; max-width:760px; margin:0 auto }
    .btn{
      display:block; width:100%; background:var(--card); color:var(--accent);
      text-align:left; padding:18px; font-size:18px; border-radius:12px;
      border:3px solid rgba(47,125,50,0.9); box-shadow: 0 4px 10px rgba(0,0,0,0.03);
      margin-bottom:14px;
    }
    .btn small{ display:block; font-size:13px; color:var(--muted); margin-top:6px }

    /* cards */
    .card{ background:var(--card); border-radius:12px; padding:12px; margin-bottom:14px; box-shadow: 0 6px 16px rgba(0,0,0,0.03)}
    .card .head{display:flex; justify-content:space-between; align-items:center;}
    .badge{ background:var(--accent); color:white; padding:6px 10px; border-radius:10px; font-weight:700 }

    footer{ text-align:center; color:var(--muted); padding:20px 8px; font-size:14px }

    /* FORCE canvas visible height and layout (patch) */
    canvas { width:100%; height:70px; display:block; }

    /* style container grafik */
    .chart { padding:12px 0; }

    /* small styles for page */
    .loading{ display:none }
    .screen{ display:none }
    .active{ display:block }
    .back-btn{ border:2px dashed var(--accent); padding:16px; border-radius:12px; margin-bottom:12px; color:var(--accent) }

    /* footer small inside page */
    .footer{ padding:12px; text-align:center; color:var(--muted) }
  </style>
</head>

<body data-theme="green">
  <div class="header">
    <div class="title">MY TANI</div>
    <div class="subtitle">Ladang Pintar Di Hujung Jari Anda</div>
  </div>

  <div class="container">

    <div class="back-btn" onclick="show('home')">← Kembali</div>

    <!-- SUHU card -->
    <div class="card">
      <div class="head">
        <div>
          <div style="font-weight:700; font-size:18px">Suhu (°C)</div>
          <div style="font-size:13px; color:var(--muted)">Updated setiap 3s</div>
        </div>
        <div class="badge" id="tempNow">--°C</div>
      </div>

      <div class="chart">
        <canvas id="tempChart"></canvas>
      </div>
    </div>

    <!-- KELEMBAPAN card -->
    <div class="card">
      <div class="head">
        <div>
          <div style="font-weight:700; font-size:18px">Kelembapan (%)</div>
          <div style="font-size:13px; color:var(--muted)">Updated setiap 3s</div>
        </div>
        <div class="badge" id="humNow">--%</div>
      </div>

      <div class="chart">
        <canvas id="humChart"></canvas>
      </div>
    </div>

    <div class="footer">
      © 2025 Hana AgroTech Sdn. Bhd.
    </div>

  </div>

  <!-- main script -->
  <script>
  /* --- utilities for drawing simple charts (vanilla canvas) --- */
  function drawLine(canvas, data, color){
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    const w = canvas.width = canvas.offsetWidth;
    const h = canvas.height = canvas.offsetHeight;
    ctx.clearRect(0,0,w,h);
    if(!data || data.length===0) return;
    const min = Math.min(...data);
    const max = Math.max(...data);
    const len = data.length;
    ctx.beginPath();
    ctx.lineWidth = 2;
    ctx.strokeStyle = color;
    data.forEach((v,i)=>{
      const x = i/(len-1)*(w-10)+5;
      const y = h - ((v-min)/( (max-min)||1 ))*(h-10) -5;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.stroke();
    // fill small area under curve (light)
    ctx.globalAlpha = 0.12;
    ctx.lineTo(w, h);
    ctx.lineTo(0, h);
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
    ctx.globalAlpha = 1;
  }

  /* simple bar chart for small stock - not used in sensor but kept for completeness */
  function drawBar(canvas, data, color){
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    const w = canvas.width = canvas.offsetWidth;
    const h = canvas.height = canvas.offsetHeight;
    ctx.clearRect(0,0,w,h);
    if(!data || data.length===0) return;
    const max = Math.max(...data);
    const barW = (w/data.length)*0.6;
    data.forEach((v,i)=>{
      const x = i*(w/data.length) + (w/data.length - barW)/2;
      const barH = (v/max)*(h-10);
      ctx.fillStyle = color;
      ctx.fillRect(x, h - barH - 5, barW, barH);
    });
  }

  /* --- sensor simulation (temp & hum) --- */
  let tempData = [25,26,27,27,28,28];
  let humData  = [60,61,62,63,62,62];

  function tickSensors(){
    // push next simulated point
    const lastT = tempData[tempData.length-1] || 27;
    const lastH = humData[humData.length-1] || 62;
    const nextT = Math.round((lastT + (Math.random()-0.5)*1.5)*10)/10;
    const nextH = Math.round((lastH + (Math.random()-0.5)*1.8)*10)/10;

    tempData.push(nextT);
    humData.push(nextH);
    if(tempData.length>12) tempData.shift();
    if(humData.length>12) humData.shift();

    // update badges
    document.getElementById('tempNow').textContent = (nextT).toFixed(1) + '°C';
    document.getElementById('humNow').textContent = (nextH).toFixed(1) + '%';

    // draw charts
    drawLine(document.getElementById('tempChart'), tempData, '#2f7d32');
    drawLine(document.getElementById('humChart'), humData, '#2f7d32');
  }

  /* start & loop */
  window.addEventListener('load', ()=>{
    // initial render (small delay to ensure layout)
    setTimeout(()=>{
      tickSensors();
      // start interval
      setInterval(tickSensors, 3000);
    }, 300);
  });

  /* --- simple navigation (kept minimal) --- */
  function show(id){
    document.querySelectorAll('.screen, .card').forEach(n=>{
      // we keep cards visible; nav toggles screens only (home/pump/drone etc)
    });
    // placeholder if you implement multiple screens later
  }

  /* --- service worker registration (sw.js must be present in same folder) --- */
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('sw.js').catch(err=>{
      console.log('SW register failed:', err);
    });
  }
  </script>

</body>
</html>
